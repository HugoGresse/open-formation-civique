---
interface Props {
  quizId: string;
  title: string;
  description: string;
  questionCount: number;
  href: string;
}

const { quizId, title, description, questionCount, href } = Astro.props;
---

<a class="quiz-card" href={href} data-quiz-id={quizId}>
  <div class="quiz-card-body">
    <h3 class="quiz-card-title">{title}</h3>
    <p class="quiz-card-desc">{description}</p>
    <p class="quiz-card-count">{questionCount} questions</p>
  </div>
  <div class="quiz-card-status" data-status-id={quizId}>
    <span class="quiz-card-badge quiz-card-badge-new">Non commenc√©</span>
  </div>
</a>

<script>
  import { getQuizResult } from '../utils/quizStorage';

  function updateCards() {
    document.querySelectorAll<HTMLElement>('[data-status-id]').forEach((el) => {
      const quizId = el.dataset.statusId;
      if (!quizId) return;
      const result = getQuizResult(quizId);
      if (result) {
        const percent = Math.round((result.score / result.total) * 100);
        const date = new Date(result.date).toLocaleDateString('fr-FR');
        el.innerHTML = `<span class="quiz-card-badge ${percent >= 60 ? 'quiz-card-badge-pass' : 'quiz-card-badge-fail'}">${result.score}/${result.total} (${percent}%)</span><span class="quiz-card-date">${date}</span>`;
      }
    });
  }

  updateCards();
</script>

<style>
  .quiz-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem 1.5rem;
    border: 2px solid var(--sl-color-gray-5);
    border-radius: 10px;
    text-decoration: none;
    color: var(--sl-color-text);
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .quiz-card:hover {
    border-color: var(--sl-color-accent);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .quiz-card-body {
    flex: 1;
    min-width: 0;
  }

  .quiz-card-title {
    margin: 0 0 0.3rem;
    font-size: 1.05rem;
  }

  .quiz-card-desc {
    margin: 0 0 0.4rem;
    font-size: 0.9rem;
    color: var(--sl-color-gray-3);
  }

  .quiz-card-count {
    margin: 0;
    font-size: 0.85rem;
    color: var(--sl-color-gray-4);
  }

  .quiz-card-status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.3rem;
    flex-shrink: 0;
  }

  .quiz-card-badge {
    display: inline-block;
    padding: 0.25rem 0.7rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    white-space: nowrap;
  }

  .quiz-card-badge-new {
    background: var(--sl-color-gray-6);
    color: var(--sl-color-gray-2);
  }

  .quiz-card-badge-pass {
    background: rgba(22, 163, 74, 0.12);
    color: #16a34a;
  }

  .quiz-card-badge-fail {
    background: rgba(220, 38, 38, 0.12);
    color: #dc2626;
  }

  .quiz-card-date {
    font-size: 0.75rem;
    color: var(--sl-color-gray-4);
  }
</style>
